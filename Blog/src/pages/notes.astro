---
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { getCollection } from 'astro:content';

const notes = (await getCollection('notes'))
    .filter(note => note.data.publish !== false)
    .sort((a, b) => {
        const aTime = a.data.updated_date?.getTime?.() || a.data.created_date?.getTime?.() || 0;
        const bTime = b.data.updated_date?.getTime?.() || b.data.created_date?.getTime?.() || 0;
        return bTime - aTime;
    });
---

<!doctype html>
<html lang="en">
    <head>
        <BaseHead title="Study Notes" description="Published study notes from my Obsidian vault." />
        <style>
            body { min-height: 100vh; display: flex; flex-direction: column; margin: 0; }
            main { flex: 1; width: 100%; max-width: 1200px; margin: 0 auto; padding: 2rem; }
            .header { text-align: center; margin-bottom: 2rem; }
            .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1rem; }
            .card { display: block; padding: 1rem; border-radius: 0.75rem; background: rgba(var(--gray-light), 0.4); color: inherit; text-decoration: none; transition: all .2s ease; }
            .card:hover { transform: translateY(-2px); background: rgba(var(--accent), 0.08); }
            .title { font-weight: 700; margin-bottom: .5rem; color: rgb(var(--black)); }
            .desc { color: rgb(var(--gray)); font-size: .95rem; }
        </style>
    </head>
    <body>
        <Header />
        <main>
            <div class="header">
                <h1>Study Notes</h1>
                <p>Curated notes synced from my Obsidian vault.</p>
            </div>
            <div class="grid">
                {notes.map((note) => (
                    <a href={("/notes/" + (note.data.slug || note.id.replace(/\.[^/.]+$/, '')))} class="card">
                        <div class="title">{note.data.title || note.id.split('/').pop()?.replace(/-/g, ' ').replace(/_/g, ' ')}</div>
                        {note.data.description && <div class="desc">{note.data.description}</div>}
                    </a>
                ))}
            </div>
        </main>
        <Footer />
    </body>
</html>

